<!-- sections/cart__main.liquid -->
{% comment %} 
  Main section of the cart template.

  Globals:
  - layout_horizontal: {string} Class string to set horizontal margin.
  - type_seperator: {string} Settting to set divider as a dot or line.
 
  Recommendations:
  - This template isn't primarly used since the cart drawer will be used instead.
{% endcomment %}

<section 
  id="{{ section.id }}"
  class="
    animation-1000
    {{ section.settings.color_border }}
    {{ section.settings.style_border }}
    {% unless section.settings.enable_color_fade %}
      {{ section.settings.color_text }}
      {% unless section.settings.color_scheme == 'custom' %}
        {{ section.settings.color_scheme }}
      {% endunless %}
    {% endunless %}
  "
  {% if section.settings.color_scheme == 'custom' %}
    {% unless section.settings.enable_color_fade %}
      style="
        background:{{ section.settings.color_background }};
      "
    {% endunless %}
  {% endif %}
  {% if section.settings.enable_color_fade %}
    :class="`${body_background_color} ${body_text_color}`"
    :style="{ background: body_background_color }"
    x-intersect.margin.-50%="
      body_background_color = '{% if section.settings.color_scheme == 'custom' %}{{ section.settings.color_background }}{% else %}{{ section.settings.color_scheme }}{% endif %}';
      body_text_color = '{{ section.settings.color_text }}';
    "
  {% endif %}>

  <div 
    class="
      {% if section.settings.enable_margin %}
        {{ settings.x_margin }}
      {% else %}
        window--full
      {% endif %}
    "
    style="
      padding-top:{{ section.settings.spacing_top }}px;
      padding-bottom:{{ section.settings.spacing_bottom }}px;
    ">

    <form 
      action="{{ routes.cart_url }}"
      method="post">
      <div 
        class="flex flex-wrap items-start">

        {% comment %} Heading {% endcomment %}
        {% if cart.item_count > 0 %}
          <div class="w-full mb-4">
            <h1>{{ 'labels.cart' | t }} <span class="font-poppins">(</span><span>{{ cart.item_count }}</span><span class="font-poppins">)</span></h1>
          </div> 
        {% else %}
          <div class="flex flex-col items-start w-full gap-4">
            <h1>{{ 'info.cart_empty' | t }}</h1>
            <a class="btn" href="{{ section.settings.empty_button_url }}">
              {{ section.settings.empty_button_label }}
            </a>
          </div>
        {% endif %}

        {% comment %} Cart {% endcomment %}
        <div 
          class="
            md:w-2/3 md:border--r-width w-full
            {{ section.settings.color_border }}
          ">
          <template x-for="(item, index) in cart.items">
            {% render 'template__cart-item' %}
          </template>
        </div>

        {% comment %} Sidebar {% endcomment %}
        {% if cart.total_price > 0 %}
          <aside 
            class="
              md:w-1/3 border--t-width sticky top-0 w-full
              {{ section.settings.color_border }}
              {{ section.settings.sidebar_color_scheme }}
            ">
              
            {% comment %} Order amounts {% endcomment %}
            <div 
              class="
                border--b-width w-full p-4 
                {{ section.settings.color_border }}
              ">
              <div 
                class="flex items-center justify-between w-full mb-1 ">
                <span>{{ 'labels.subtotal' | t }}</span>
                <span x-html="Shopify.formatMoney(cart.original_total_price, true)">{% render 'component__format-price', price: cart.original_total_price %}</span>
              </div>
              <div 
                class="flex items-center justify-between w-full mb-1 ">
                <span>{{ 'labels.discount' | t }}</span>
                <span x-html="'-' + Shopify.formatMoney(cart.total_discount, true)">-{% render 'component__format-price', price: cart.total_discount %}</span>
              </div>
              <div 
                class="flex items-center justify-between w-full ">
                <span class="flex items-center">
                  <strong>{{ 'labels.total' | t }}</strong>
                  {% if cart.taxes_included %}
                    {% capture taxes_included %}
                      {{ 'info.tax_included' | t }}
                    {% endcapture %}
                    <div class="ml-1">
                      {% render 'component__badge', 
                        background: 'shade-1',
                        text: 'dark',
                        icon: '',
                        content: taxes_included %}
                    </div>
                  {% endif %}
                </span>
                <strong x-html="Shopify.formatMoney(cart.total_price, true)">{% render 'component__format-price', price: cart.total_price %}</strong>
              </div>
            </div>

            {% comment %} Notes {% endcomment %}
            {% if section.settings.enable_cart_note %}
              <div 
                class="
                  border--b-width w-full p-4 
                  {{ section.settings.color_border }}
                " 
                x-data="{ 
                  reveal: cart.note != '',
                  currentNote: cart.note 
                }"
                x-show="cart.items.length > 0"
                x-cloak>
                <label class="flex items-center">
                  <label
                    class="sr-only"
                    for="notes">
                    {{ 'actions.add_order_note' | t }}
                  </label>
                  <input 
                    id="notes" 
                    class=""
                    type="checkbox"
                    :checked="reveal" 
                    @click="reveal = ! reveal">
                  <p class="mb-0 ml-2 text--small">{{ 'actions.add_order_note' | t }}</p>
                </label>
                <textarea 
                  class="w-full mt-2"
                  placeholder="{{ 'actions.message_placeholder' | t }}"
                  name="note"
                  x-model="currentNote"
                  @keyup.debounce="updateCartNote(currentNote)"
                  x-show="reveal"
                  x-cloak></textarea>
              </div>
            {% endif %}

            {% comment %} Checkout buttons {% endcomment %}
            <div class="mt-auto">
              <div class="w-full p-4 dynamic_checkout">
                <label
                  class="sr-only"
                  for="checkout">
                  {{ 'actions.checkout' | t }}
                </label>
                <input 
                  id="checkout"
                  class="!w-full btn mb-2 whitespace-normal"
                  type="submit" 
                  name="checkout" 
                  value="
                    {{ 'actions.checkout' | t }} 
                    {% if settings.type_seperator == 'dot' %}Â·{% else %}|{% endif %} 
                    {{ cart.total_price | money_with_currency | strip_html }}
                  ">
                {% if section.settings.enable_dynamic_checkout %}
                  {% if additional_checkout_buttons %}
                    <div 
                      class="mb-2 additional-checkout-buttons additional-checkout-buttons--vertical">
                      {{ content_for_additional_checkout_buttons }}
                    </div>
                  {% endif %}
                {% endif %}
                {% unless section.settings.disclaimer == blank %}
                  <div class="type--smaller ">
                    {{ section.settings.disclaimer }}
                  </div>
                {% endunless %}
              </div>
            </div>

          </aside>
        {% endif %}

      </div>
    </form>
      
  </div>
</section>

{% schema %}
{
  "name":"t:sections.cart.name",
  "class": "sections-main-cart",
  "settings":[
    {
      "type":"header",
      "content":"t:general.headers.spacing.content"
    },
    {
      "type":"range",
      "id":"spacing_top",
      "min":0,
      "max":300,
      "step":10,
      "unit":"px",
      "label":"t:general.settings.top_spacing.label",
      "default":100
    },
    {
      "type":"range",
      "id":"spacing_bottom",
      "min":0,
      "max":300,
      "step":10,
      "unit":"px",
      "label":"t:general.settings.bottom_spacing.label",
      "default":100
    },
    {
      "type":"header",
      "content":"t:general.headers.color.content"
    },
    {
      "type":"select",
      "id":"color_scheme",
      "label":"t:general.settings.color_scheme.label",
      "options":[
        {
          "value":"color__bg-body",
          "label":"t:general.settings.color_scheme.body.label"
        },
        {
          "value":"color__bg-neutral",
          "label":"t:general.settings.color_scheme.neutral.label"
        },
        {
          "value":"color__bg-overlay-1",
          "label":"t:general.settings.color_scheme.accent_1.label"
        },
        {
          "value":"color__bg-overlay-2",
          "label":"t:general.settings.color_scheme.accent_2.label"
        },
        {
          "value":"color__bg-overlay-3",
          "label":"t:general.settings.color_scheme.accent_3.label"
        },
        {
          "value":"color__bg-shade-1",
          "label":"t:general.settings.color_scheme.shade_1.label"
        },
        {
          "value":"color__bg-shade-2",
          "label":"t:general.settings.color_scheme.shade_2.label"
        },
        {
          "value":"color__bg-shade-3",
          "label":"t:general.settings.color_scheme.shade_3.label"
        },
        {
          "value":"color__bg-primary",
          "label":"t:general.settings.color_scheme.primary.label"
        },
        {
          "value":"color__bg-secondary",
          "label":"t:general.settings.color_scheme.secondary.label"
        },
        {
          "value":"color__bg-tertiary",
          "label":"t:general.settings.color_scheme.tertiary.label"
        },
        {
          "value":"custom",
          "label":"t:general.settings.color_scheme.custom.label"
        }
      ],
      "default":"color__bg-body"
    },
    {
      "type":"color",
      "id":"color_background",
      "label":"t:general.settings.color_custom.label",
      "info":"t:general.settings.color_custom.info",
      "default":"#ffffff"
    },
    {
      "type":"select",
      "id":"color_text",
      "label":"t:general.settings.color_text.label",
      "options":[
        {
          "value":"",
          "label":"t:general.settings.color_text.default.label"
        },
        {
          "value":"color__light",
          "label":"t:general.settings.color_text.force_light.label"
        },
        {
          "value":"color__dark",
          "label":"t:general.settings.color_text.force_dark.label"
        }
      ],
      "default":""
    },
    {
      "type":"select",
      "id":"color_border",
      "label":"t:general.settings.color_border.label",
      "options":[
        {
          "value":"color__border-divider-1",
          "label":"t:general.settings.color_border.subtle.label"
        },
        {
          "value":"color__border-selected-1",
          "label":"t:general.settings.color_border.strong.label"
        },
        {
          "value":"!color__border-transparent",
          "label":"t:general.settings.color_border.none.label"
        }
      ],
      "default":"color__border-divider-1"
    },
    {
      "type":"checkbox",
      "id":"enable_color_fade",
      "label":"t:general.settings.enable_color_fade.label",
      "info":"t:general.settings.enable_color_fade.info",
      "default":false
    },
    {
      "type":"header",
      "content":"t:general.headers.style.content"
    },
    {
      "type":"select",
      "id":"style_border",
      "label":"t:general.settings.border_position.label",
      "options":[
        {
          "value":"",
          "label":"t:general.settings.border_position.none.label"
        },
        {
          "value":"border--t-width",
          "label":"t:general.settings.border_position.top.label"
        },
        {
          "value":"border--b-width",
          "label":"t:general.settings.border_position.bottom.label"
        },
        {
          "value":"border--b-width border--t-width",
          "label":"t:general.settings.border_position.top_and_bottom.label"
        }
      ],
      "default":"border--b-width"
    },
    {
      "type":"header",
      "content":"t:general.headers.layout.content"
    },
    {
      "type":"checkbox",
      "id":"enable_margin",
      "label":"t:general.settings.enable_margin.label",
      "default":true
    },
    {
      "type":"header",
      "content":"t:general.headers.display.content"
    },
    {
      "type":"checkbox",
      "id":"enable_cart_note",
      "label":"t:general.settings.enable_cart_note.label"
    },
    {
      "type":"checkbox",
      "id":"enable_dynamic_checkout",
      "label":"t:general.settings.enable_dynamic_checkout.label"
    },
    {
      "type":"checkbox",
      "id":"main_enable_cart_sku",
      "label":"t:general.settings.enable_cart_sku.label",
      "default":false
    },
    {
      "type":"header",
      "content":"t:general.headers.sidebar.content"
    },
    {
      "type":"select",
      "id":"sidebar_color_scheme",
      "label":"t:general.settings.color_scheme.label",
      "options":[
        {
          "value":"color__bg-body color__text",
          "label":"t:general.settings.color_scheme.body.label"
        },
        {
          "value":"color__bg-neutral color__text",
          "label":"t:general.settings.color_scheme.neutral.label"
        },
        {
          "value":"color__bg-overlay-1 color__text",
          "label":"t:general.settings.color_scheme.accent_1.label"
        },
        {
          "value":"color__bg-overlay-2 color__text",
          "label":"t:general.settings.color_scheme.accent_2.label"
        },
        {
          "value":"color__bg-overlay-3 color__text",
          "label":"t:general.settings.color_scheme.accent_3.label"
        },
        {
          "value":"color__bg-shade-1 color__text",
          "label":"t:general.settings.color_scheme.shade_1.label"
        },
        {
          "value":"color__bg-shade-2 color__text",
          "label":"t:general.settings.color_scheme.shade_2.label"
        },
        {
          "value":"color__bg-shade-3 color__text",
          "label":"t:general.settings.color_scheme.shade_3.label"
        },
        {
          "value":"color__bg-primary color__primary",
          "label":"t:general.settings.color_scheme.primary.label"
        },
        {
          "value":"color__bg-secondary color__secondary",
          "label":"t:general.settings.color_scheme.secondary.label"
        },
        {
          "value":"color__bg-tertiary color__tertiary",
          "label":"t:general.settings.color_scheme.tertiary.label"
        }
      ],
      "default":"color__bg-shade-1 color__text"
    },
    {
      "type":"richtext",
      "id":"disclaimer",
      "label":"t:general.settings.checkout_disclaimer.label"
    },
    {
      "type":"header",
      "content":"t:general.headers.empty_cart.content"
    },
    {
      "type":"text",
      "id":"empty_button_label",
      "label":"t:general.settings.button_label.label",
      "default":{
        "en":"Shop all",
        "es":"Comprar todo",
        "it":"Acquista tutto",
        "de":"Alles kaufen",
        "fr":"Magasiner tout"
      }
    },
    {
      "type":"url",
      "id":"empty_button_url",
      "label":"t:general.settings.button_url.label",
      "default":"/collections/all"
    }
  ],
  "presets":[
    {
      "name":"t:sections.cart.name"
    }
  ],
  "templates":[
    "cart"
  ]
}
{% endschema %}