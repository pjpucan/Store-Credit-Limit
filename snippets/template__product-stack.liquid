<!-- snippets/template__product-stack.liquid -->
{% comment %} 
  Upsell item with button to add to cart

  Usage:
    {% render 'template__product-stack' %}
  
  Recommendations:
    - Must be used within a <template> tag with AlpineJS enabled
{% endcomment %}

<div 
  class="
    group border--radius upsell relative flex justify-center flex-none overflow-hidden whitespace-normal w-full
    {{ settings.product_card_color_border }}
  "
  x-show="item.available"
  x-data="{ 
    button_loading: false
  }">

  {% comment %} Content {% endcomment %}
  <div 
    class="
      flex items-start w-full
      {{ settings.product_card_color_scheme }} 
    ">

    {% comment %} Image {% endcomment %}
    <div 
      class="w-[25%] h-full flex-none overflow-hidden flex justify-center">
      <a 
        class="object-cover flex items-center aspect-[1/1] h-full w-full color__bg-shade-2 hover:opacity-100"
        :href="`${item.url}`">
        <img 
          class="object-cover w-full h-full color__bg-shade-2"
          width="200"
          height="200"
          loading="lazy"
          :src="`${ item.featured_image }&width=750`" 
          :alt="`${ item.title }`" />
      </a>
    </div>

    {% comment %} Content {% endcomment %}
    <div 
      class="flex items-start justify-between flex-grow w-full h-full gap-4 p-4 text-left">

      {% comment %} Title and price {% endcomment %}
      <div>
        <h3
          class="type__body type--base"
          x-text="item.title">
        </h3>
        {% if settings.product_card_show_prices %}
          <span
            x-html="Shopify.formatMoney(item.price)">
          </span>
        {% endif %}
      </div>

      {% comment %} Quick add {% endcomment %}
      <div 
        class="flex gap-1">
        <form 
          class="flex flex-wrap" 
          action="/cart/add" 
          method="post" 
          enctype="multipart/form-data"
          x-data="{
            current_variant_id: item.variants[0].id,
            current_variant_selling_plan_id: 0,
            quantity: 1,
          }"
          @submit.prevent="
            button_loading = true; 
            addCartItem(current_variant_id, current_variant_selling_plan_id, quantity, true); 
            setTimeout(function(){ button_loading = false}, 500);
          ">
      
          {% comment %} Add to cart {% endcomment %}
          <div 
            x-show="item.variants.length == 1"> 
            <input 
              name="id" 
              type="hidden"
              :value="current_variant_id">
            <label 
              class="sr-only"
              :for="'quantity_t_upsell_grid_item_' + item.id + '-{{ section.id }}'">
              {{ 'labels.quantity' | t }}
            </label>
            <input 
              name="quantity" 
              type="hidden" 
              value="1" 
              min="1"
              max="" 
              :id="'quantity_t_upsell_grid_item_' + item.id + '-{{ section.id }}'"
              x-model="quantity">
            <button 
              class="btn btn--secondary btn--smaller"
              :class="{
                'animate-pulse': button_loading
              }"
              type="submit" 
              role="button">
              <div class="btn__content">
                {{ 'actions.add' | t }}
              </div>
            </button>
          </div>
    
          {% comment %} Open quick add overlay {% endcomment %}
          <div
            x-show="item.variants.length > 1">
            <button 
              class="btn btn--secondary btn--smaller"
              :class="{
                'animate-pulse': button_loading
              }"
              type="button" 
              role="button"
              @click="
                button_loading = true; 
                fetchAndRenderQuickAdd(item.handle);
                setTimeout(function(){ button_loading = false}, 500);
              ">
              <div class="btn__content">
                {{ 'actions.add' | t }}
              </div>
            </button>
          </div>

        </form>
      </div>

    </div>

  </div>


</div>