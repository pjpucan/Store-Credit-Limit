<!-- templates/customers/order.liquid -->

<!-- 
  TODO:
  - add spacing back to top bottoms (reorder, add address, etc)
 -->
 
 <section>
  <div class="py-12
    {{ settings.x_margin }}
    {{ settings.x_alignment }}">

    {% comment %} Heading {% endcomment %}
    <div class="flex flex-col w-full gap-4 mb-4 max-w-prose">
      <h1>
        {{ 'labels.account' | t }}
      </h1>
      <div>
        <a href="{{ routes.account_url }}" class="btn btn--plain btn--smaller">{{ 'actions.back' | t }}</a>
      </div>
    </div>
    
    {% comment %} Content {% endcomment %}
    <div class="flex flex-wrap items-start pt-8 border--t-width color__border-divider-1 md:gap-x-16 md:gap-y-0 gap-y-8">
      
      {% comment %} Sidebar {% endcomment %}
      <div class="w-full pb-8 md:w-auto border--b-width color__border-divider-1 grow">
        <p class="mb-4 type__heading">
          {{ 'labels.default_address' | t }}
        </p>
        <div class="type--small">
          <p class="mb-1">
            {{ customer.name }}
          </p>
          <p class="mb-1">
            {{ customer.email }}
          </p>
          {% if customer.default_address %}
            <p class="mb-1">{{ customer.default_address.address1 }}</p>
            {% if customer.default_address.address2 != blank %}
              <p class="mb-1">{{ customer.default_address.address2 }}</p>
            {% endif %}
            <p class="mb-1">
              {{ customer.default_address.city }}, 
              {% if customer.default_address.province_code %}
                {{ customer.default_address.province_code }}
              {% endif %}
              , {{ customer.default_address.country_code }}
            </p>
            <p class="mb-1">{{ customer.default_address.zip_code }}</p>
            <p class="mb-0">{{ customer.default_address.phone }}</p>
          {% endif %}
        </div>
      </div>
      
      {% comment %} Main content {% endcomment %}
      <div class="flex flex-col w-full md:w-2/3">

        <div class="flex flex-row flex-wrap items-end justify-between">
          <div class="w-full mb-2 max-w-prose md:w-auto">
            <p class="mb-0 type__heading">
              {{ 'labels.addresses' | t }}
            </p>
          </div>
          <div class="w-full mb-2 md:w-auto" x-data="{ popup: false }">
            <button class="btn btn--small btn--secondary" @click="popup = true;">{{ 'actions.add_address' | t }}</button>
            {% capture popup_content %}
              {% capture address_create_button %} {{ 'actions.add_address' | t }}{% endcapture %}
              {%
                render 'addresses__form',
                id: 'new',
                action: customer.new_address,
                cta: address_create_button
              %}
            {% endcapture %}
            {% render 'component__popup', 
              popup_id: 'popup',
              content: popup_content 
            %}
          </div>
        </div>

        {% paginate customer.addresses by 10 %}
          {% for address in customer.addresses %}
            <div class="py-8 color__border-divider-1 border--b-width">
              
              <p class="mb-1">
                {{ customer.name }}
              </p>
              <p class="mb-1">
                {{ customer.email }}
              </p>
              {% if customer.default_address %}
                <p class="mb-1">{{ customer.default_address.address1 }}</p>
                {% if customer.default_address.address2 != blank %}
                  <p class="mb-1">{{ customer.default_address.address2 }}</p>
                {% endif %}
                <p class="mb-1">
                  {{ customer.default_address.city }}, 
                  {% if customer.default_address.province_code %}
                    {{ customer.default_address.province_code }}
                  {% endif %}
                  , {{ customer.default_address.country_code }}
                </p>
                <p class="mb-1">{{ customer.default_address.zip_code }}</p>
                <p class="mb-0">{{ customer.default_address.phone }}</p>
              {% endif %}

              <div class="mt-4" x-data="{ popup: false }">   
                <form
                  method="post"
                  action="{{ routes.account_addresses_url }}/{{ address.id }}">
                  <input type="hidden" name="_method" value="delete">
                  <button type="button" class="btn btn--small btn--secondary" @click="popup = true;">{{ 'actions.edit' | t }}</button>
                  <button type="submit" class="btn btn--small btn--plain">{{ 'actions.delete' | t }}</button>
                </form>
                {% capture popup_content %}
                  {% capture address_edit_button %} {{ 'actions.edit' | t }}{% endcapture %}
                  {%
                    render 'addresses__form',
                    id: address.id,
                    action: address,
                    cta: address_edit_button
                  %}
                {% endcapture %}
                {% render 'component__popup', 
                  popup_id: 'popup',
                  content: popup_content 
                %}
              </div>

            </div>
          {% endfor %}

          <section class="py-4 mt-4 border--t-width color__border-divider-1">
            {% if paginate.pages > 1 %}
              <div class="mb-4 text-center">
                <span>{{ 'labels.showing_pages' | t }}</span>
                <span>{{ paginate.current_page }}</span>
                {{ 'labels.of' | t | downcase }}
                <span>{{ paginate.pages }}</span>
              </div>
            {% endif %}
            <div class="text-center">
              {% if paginate.previous.is_link %}
                <a class="btn btn--small btn--plain" href="{{ paginate.previous.url }}">{{ paginate.previous.title }}</a>
              {% endif %}
              {% if paginate.next.is_link %}
                <a class="btn btn--small btn--plain" href="{{ paginate.next.url }}">{{ paginate.next.title }}</a>
              {% endif %}
            </div>
          </section>

          <script type="module">
            window.slater = {
              toggleForm: function(id) {
                var el = document.getElementById('form_'+id)
                el.style.display = el.style.display == 'none' ? '' : 'none'
              },
              toggleNewForm: function() {
                var el = document.getElementById('form_new')
                el.style.display = el.style.display == 'none' ? '' : 'none'
              },
              removeAddress: function removeAddress(id){
                if (!confirm('Are you sure you wish to delete this address?')) return

                var form = document.createElement('form')
                var input = document.createElement('input');

                form.setAttribute('method', 'post')
                form.setAttribute('action', '/account/addresses/'+id)

                input.setAttribute('type', 'hidden')
                input.setAttribute('name', '_method')
                input.setAttribute('value', 'delete')

                form.appendChild(input)

                document.body.appendChild(form)
                form.submit()
                document.body.removeChild(form)
              }
            }
          </script>
        {% endpaginate %}

      </div>
      
    </div>

  </div>
</section>